function initKeynapse(){var keynapse=window.keynapse||(window.keynapse={});return keynapse.knCells=[],keynapse.currentKnCell=null,keynapse.currentKnCellIndex=0,keynapse.isStarted=!1,keynapse.cellHotKeys=["1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],keynapse.cellIndexBykeyCode={49:0,50:1,51:2,52:3,53:4,54:5,55:6,56:7,57:8,97:9,98:10,99:11,100:12,101:13,102:14,103:15,104:16,105:17,106:18,107:19,108:20,109:21,110:22,111:23,112:24,113:25,114:26,115:27,116:28,117:29,118:30,119:31,120:32,121:33,122:34,65:9,66:10,67:11,68:12,69:13,70:14,71:15,72:16,73:17,74:18,75:19,76:20,77:21,78:22,79:23,80:24,81:25,82:26,83:27,84:28,85:29,86:30,87:31,88:32,89:33,90:34},keynapse}function prepareApplication(){addKnPanel();var keynapse=window.keynapse;keynapse.listener=new window.keypress.Listener,registerStartKeys(keynapse)}function addKnPanel(){var zIndex=getMaxZIndex()+10,panel=$("<div kn-panel class=kn-panel></div>");panel.css("z-index",zIndex),$("body").append(panel)}function registerStartKeys(keynapse){registerInitCombo(keynapse,"ctrl shift up"),registerInitCombo(keynapse,"ctrl shift down"),registerInitCombo(keynapse,"ctrl shift left"),registerInitCombo(keynapse,"ctrl shift right"),keynapse.listener.simple_combo("esc",resetKeynapse)}function resetKeynapse(){if(keynapse.isStarted)if(keynapse.currentKnCellIndex>0){var previousKnCell=keynapse.currentKnCell;previousKnCell.knCellHint.removeClass("kn-cell-hint-current"),keynapse.currentKnCellIndex=0,keynapse.currentKnCell=keynapse.knCells[0],keynapse.currentKnCell.knCellHint.addClass("kn-cell-hint-current")}else stopKeynapse()}function registerNavigationKeys(keynapse){keynapse.listener.simple_combo("tab",nextKnCell),keynapse.listener.simple_combo("enter",selectKnCell)}function unregisterNavigationKeys(keynapse){keynapse.listener.unregister_combo("tab"),keynapse.listener.unregister_combo("enter");for(var i=keynapse.cellHotKeys.length-1;i>=0;i--)keynapse.listener.unregister_combo(keynapse.cellHotKeys[i])}function startKeynapse(){return window.keynapse.isStarted?void stopKeynapse():(registerNavigationKeys(window.keynapse),$("[kn-panel]").fadeIn(),$("[kn-cell]").each(function(){if(keynapse.knCells.push(this),addKnCellHint(this),1==keynapse.knCells.length&&null===keynapse.currentKnCell?(keynapse.currentKnCell=this,keynapse.currentKnCellIndex=0,this.knCellHint.addClass("kn-cell-hint-current")):keynapse.currentKnCell.knCellHint.addClass("kn-cell-hint-current"),keynapse.knCells.length<=keynapse.cellHotKeys.length){var cellHotKey=keynapse.cellHotKeys[keynapse.knCells.length-1];keynapse.listener.simple_combo(cellHotKey,selectKnCellByIndex)}}),void(window.keynapse.isStarted=!0))}function stopKeynapse(){window.keynapse.isStarted&&(unregisterNavigationKeys(window.keynapse),keynapse.knCells=[],$("[kn-panel]").fadeOut(),$("[kn-cell]").each(function(){$(this).removeClass("kn-cell"),$(this).removeClass("kn-cell-current")}),removeKnCellHint(),window.keynapse.isStarted=!1)}function nextKnCell(){var previousKnCell=keynapse.currentKnCell;previousKnCell.knCellHint.removeClass("kn-cell-hint-current");var currentKnCell;keynapse.currentKnCellIndex==keynapse.knCells.length-1?(keynapse.currentKnCellIndex=0,keynapse.currentKnCell=keynapse.knCells[keynapse.currentKnCellIndex],currentKnCell=keynapse.currentKnCell):(keynapse.currentKnCell=keynapse.knCells[++keynapse.currentKnCellIndex],currentKnCell=keynapse.currentKnCell),currentKnCell.knCellHint.addClass("kn-cell-hint-current")}function selectKnCellByIndex(e){var previousKnCell=keynapse.currentKnCell;previousKnCell.knCellHint.removeClass("kn-cell-hint-current");var currentKnCellIndex=keynapse.cellIndexBykeyCode[e.keyCode];keynapse.currentKnCellIndex=currentKnCellIndex,keynapse.currentKnCell=keynapse.knCells[currentKnCellIndex],keynapse.currentKnCell.knCellHint.addClass("kn-cell-hint-current")}function selectKnCell(){var knCell=keynapse.currentKnCell;stopKeynapse(),"text"==knCell.type?$(knCell).focus():($(knCell).focus(),$(knCell).trigger("click"))}function registerInitCombo(keynapse,combo){keynapse.listener.register_combo({keys:combo,on_keydown:startKeynapse,on_keyup:null,on_release:null,"this":void 0,prevent_default:!1,prevent_repeat:!1,is_unordered:!0,is_counting:!1,is_exclusive:!1,is_solitary:!1,is_sequence:!1})}function addKnCellHint(knCell){var parentPosition=$(knCell).position(),parentWidth=$(knCell).width(),left=($(knCell).height(),parentPosition.left-parentWidth%2+5),top=parentPosition.top+5,knCellIndex=window.keynapse.knCells.indexOf(knCell),label=keynapse.cellHotKeys[knCellIndex],knCellHintDiv="<span kn-cell-hint class=kn-cell-hint>"+label+"</span>",knCellHint=$(knCellHintDiv).insertAfter($(knCell));$(knCellHint).css("top",top+"px"),$(knCellHint).css("left",left+"px"),knCell.knCellHint=knCellHint,$(knCellHint).show()}function removeKnCellHint(){$("[kn-cell-hint]").remove()}function getMaxZIndex(){var group="*",zmax=0;return $(group).each(function(){var cur=parseInt($(this).css("z-index"));zmax=void 0!==cur&&cur>zmax?cur:zmax}),zmax}!function(window,document){if(window.keynapse)return void console.log("WARNING: hum... nothing.");initKeynapse();$(document).ready(function(){prepareApplication()})}(window,document);